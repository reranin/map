# 🗺️ بهینه‌ساز مسیر Neshan

ابزاری برای بهینه‌سازی مسیر با استفاده از Neshan Web SDK و Node.js

## ✨ ویژگی‌ها

- 🗺️ نقشه تعاملی Neshan با SDK رسمی
- 📍 اضافه کردن لوکیشن‌ها با نام یا کلیک روی نقشه
- 📱 دریافت موقعیت فعلی کاربر
- 🚀 بهینه‌سازی مسیر با الگوریتم TSP (مسئله فروشنده دوره‌گرد)
- 🛣️ **نمایش مسیر واقعی جاده‌ای** با استفاده از Neshan Direction API
- 🔢 نمایش شماره توقف‌گاه‌ها روی نقشه
- 📊 نمایش اطلاعات مسیر، مسافت و زمان کل
- 🎨 رابط کاربری زیبا و ریسپانسیو
- 🔧 API های RESTful برای geocoding، مسیریابی و بهینه‌سازی

## 🚀 نصب و راه‌اندازی

### پیش‌نیازها
- Node.js (نسخه 14 یا بالاتر)
- npm یا yarn

### روش 1: نصب خودکار (توصیه می‌شود) ⭐

**لینوکس/مک:**
```bash
./setup.sh
```

**ویندوز:**
```cmd
setup.bat
```

این اسکریپت به طور خودکار:
- وابستگی‌های npm را نصب می‌کند
- فایل `.env` را می‌سازد
- تنظیمات اولیه را انجام می‌دهد

### روش 2: نصب دستی

#### نصب dependencies
```bash
npm install
```

#### تنظیم فایل محیطی (.env)
فایل `.env` را در ریشه پروژه بسازید و محتوای زیر را در آن قرار دهید:

```env
NESHAN_API_KEY=web.89a6be71092e4dc1925b0f47e926e894
PORT=3000
NESHAN_BASE_URL=https://api.neshan.org/v1
```

**توجه**: برای دریافت API Key اختصاصی خود، به [پنل نشان](https://platform.neshan.org) مراجعه کنید.

### اجرای پروژه
```bash
# حالت development
npm run dev

# یا حالت production
npm start
```

### دسترسی به اپلیکیشن
پس از اجرای سرور، به آدرس زیر بروید:
```
http://localhost:3000
```

## 🚀 نحوه استفاده

1. سرور را اجرا کنید
2. در مرورگر به `http://localhost:3000` بروید
3. لوکیشن‌های مورد نظر خود را اضافه کنید:
   - با تایپ نام و کلیک روی "اضافه کردن"
   - با کلیک روی نقشه
   - با استفاده از دکمه "موقعیت فعلی من"
4. روی "بهینه‌سازی مسیر" کلیک کنید
5. مسیر بهینه روی نقشه نمایش داده می‌شود

## 🛠️ تکنولوژی‌های استفاده شده

### Backend
- **Node.js** - محیط اجرای JavaScript
- **Express.js** - فریمورک وب
- **Axios** - برای درخواست‌های HTTP
- **CORS** - برای مدیریت CORS

### Frontend
- **Neshan Web SDK** - برای نمایش نقشه
- **HTML5** - ساختار صفحه
- **CSS3** - طراحی و استایل
- **JavaScript** - منطق برنامه
- **Leaflet** - کتابخانه نقشه (از طریق Neshan SDK)

## 📁 ساختار پروژه

```
NeshanApp/
├── server.js           # سرور Express
├── config.js           # تنظیمات پروژه
├── package.json        # وابستگی‌ها و اسکریپت‌ها
├── index.html          # صفحه اصلی
├── styles.css          # استایل‌ها
├── script.js           # منطق JavaScript کلاینت
└── readme.md           # مستندات
```

## 🧪 تست نقشه نشان

برای تست SDK نشان، می‌توانید فایل `test-simple.html` را در مرورگر باز کنید:
```
http://localhost:3000/test-simple
```

این صفحه امکانات زیر را دارد:
- نمایش نقشه نشان
- تغییر استایل‌های مختلف نقشه
- افزودن مارکر با کلیک روی نقشه

## 🔧 تنظیمات

تنظیمات پروژه در فایل `.env` قرار دارند [[memory:5833805]]:
```bash
NESHAN_API_KEY=web.89a6be71092e4dc1925b0f47e926e894
PORT=3000
NESHAN_BASE_URL=https://api.neshan.org/v1
```

**نکته مهم**: اگر API Key نشان کار نکرد، نگران نباشید! سیستم به طور خودکار از OpenStreetMap Nominatim برای geocoding استفاده می‌کند.

## 📡 API Endpoints

### POST /api/geocode
جستجوی لوکیشن بر اساس نام
```json
{
  "locationName": "تهران، میدان آزادی"
}
```

### POST /api/reverse-geocode
تبدیل مختصات به آدرس
```json
{
  "lat": 35.6961,
  "lng": 51.4231
}
```

### POST /api/get-route
دریافت مسیر واقعی جاده‌ای بین دو نقطه
```json
{
  "origin": { "lat": 35.6961, "lng": 51.4231 },
  "destination": { "lat": 35.7219, "lng": 51.3347 }
}
```

**پاسخ:**
```json
{
  "success": true,
  "route": [[35.6961, 51.4231], [35.6965, 51.4235], ...],
  "distance": 15.2,
  "duration": 1200
}
```

### POST /api/optimize-route
بهینه‌سازی مسیر
```json
{
  "locations": [
    {
      "id": 1234567890,
      "name": "تهران",
      "lat": 35.6961,
      "lng": 51.4231
    }
  ]
}
```

## 📱 سازگاری

- ✅ Chrome, Firefox, Safari, Edge
- ✅ موبایل و تبلت
- ✅ موقعیت‌یابی GPS

## 🎯 الگوریتم بهینه‌سازی

از الگوریتم **Nearest Neighbor** برای حل مسئله TSP استفاده شده است که:
- نزدیک‌ترین لوکیشن بعدی را انتخاب می‌کند
- مسافت کل را به حداقل می‌رساند
- برای تعداد کم تا متوسط لوکیشن کارایی خوبی دارد

## 🚀 اسکریپت‌های npm

- `npm start` - اجرای سرور در حالت production
- `npm run dev` - اجرای سرور در حالت development با nodemon

## 📞 پشتیبانی

برای سوالات و پشتیبانی، به [مستندات Neshan](https://platform.neshan.org/sdk/web-sdk-getting-started/) مراجعه کنید.